{% extends "_layout.twig" %}

{% block content %}
    <h1>Photography</h1>

    <p style="margin-bottom: 2rem;">Browse my photography by genre.</p>

    {% set genres = craft.entries()
        .section('photography')
        .type('genre')
        .level(1)
        .orderBy('title ASC')
        .all() %}

    {% if genres|length %}
        <ul class="entry-list">
            {% for genre in genres %}
                <li>
                    {% if genre.featuredImage|length %}
                        {% set image = genre.featuredImage.one() %}
                        <img src="{{ image.url }}" alt="{{ image.title }}" style="width: 100%; height: 250px; object-fit: cover; border-radius: 8px; margin-bottom: 1rem;">
                    {% endif %}

                    <h3><a href="{{ genre.url }}">{{ genre.title }}</a></h3>

                    <div class="meta">
                        {% set albumCount = craft.entries()
                            .section('photography')
                            .type('album')
                            .descendantOf(genre)
                            .count() %}
                        {% if albumCount %}
                            üìÅ {{ albumCount }} album{{ albumCount != 1 ? 's' : '' }}
                        {% endif %}

                        {% set photoCount = craft.entries()
                            .section('photography')
                            .type('photo')
                            .descendantOf(genre)
                            .count() %}
                        {% if photoCount %}
                            | üì∏ {{ photoCount }} photo{{ photoCount != 1 ? 's' : '' }}
                        {% endif %}
                    </div>

                    {% if genre.description %}
                        <p>{{ genre.description|length > 250 ? genre.description|slice(0, 250) ~ '...' : genre.description }}</p>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p style="padding: 2rem; background: #f8f9fa; border-radius: 8px; text-align: center;">
            No photography genres yet. Create some in the Craft control panel!
        </p>
    {% endif %}
{% endblock %}
